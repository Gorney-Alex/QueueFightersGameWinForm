# –ß—Ç–æ —É –º–µ–Ω—è —Å–µ–π—á–∞—Å –∏–º–µ–µ—Ç—Å—è

–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –≤ –ø—É–Ω–∫—Ç–µ –≤—ã–¥–∞—á–∏, –≤–∫–ª—é—á–∞—é—â–∏–π —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞ –æ—Ç –∫—É—Ä—å–µ—Ä–∞
- –í—ã–¥–∞—á–∞ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç—É
- –ü—Ä–∏—ë–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
- –í–æ–∑–≤—Ä–∞—Ç –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä—É
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞

### –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞ –æ—Ç –∫—É—Ä—å–µ—Ä–∞

```mermaid
sequenceDiagram
    participant Client as üì± API –ö–ª–∏–µ–Ω—Ç
    participant Service as üîÑ –°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤
    participant TxManager as üîí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    participant Cache as üì¶ –ö—ç—à

    Note over Client,Cache: –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
    
    Client->>+Service: –ó–∞–ø—Ä–æ—Å: –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑
    Service->>+TxManager: –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏
    TxManager->>DB: –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑ –ø–æ ID
    DB-->>TxManager: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞
    TxManager-->>-Service: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    
    alt –ó–∞–∫–∞–∑ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        Service-->>Client: ‚ùå –û—à–∏–±–∫–∞: –∑–∞–∫–∞–∑ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    else –ó–∞–∫–∞–∑ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        Note over Client,Cache: –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
        
        Service->>+TxManager: –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è
        TxManager->>DB: –í—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
        DB-->>TxManager: –£—Å–ø–µ—Ö
        TxManager-->>-Service: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
        
        Service->>Cache: –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        Service-->>-Client: ‚úÖ –£—Å–ø–µ—Ö: –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç
    end
```

### –í—ã–¥–∞—á–∞ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç—É

```mermaid
sequenceDiagram
    participant Client as üì± API –ö–ª–∏–µ–Ω—Ç
    participant Service as üîÑ –°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤
    participant TxManager as üîí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    participant Cache as üì¶ –ö—ç—à

    Client->>+Service: –ó–∞–ø—Ä–æ—Å: –í—ã–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç—É
    
    Note over Client,Cache: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
    
    Service->>+TxManager: –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤—ã–¥–∞—á–∏
    
    Note over TxManager,DB: –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞
    TxManager->>DB: –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑ –ø–æ ID
    DB-->>TxManager: –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
    
    alt –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
        Note right of TxManager: –ü—Ä–æ–≤–µ—Ä–∫–∏:- –ó–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç- –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é- –î–æ—Å—Ç—É–ø–µ–Ω –∫ –≤—ã–¥–∞—á–µ- –ù–µ –∏—Å—Ç–µ–∫ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è
        TxManager-->>Service: ‚ùå –ó–∞–∫–∞–∑ –Ω–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É
        Service-->>Client: –û—à–∏–±–∫–∞: –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã
    else –ó–∞–∫–∞–∑ –≤–∞–ª–∏–¥–µ–Ω
        Note over TxManager,DB: –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
        
        TxManager->>DB: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ "–í—ã–¥–∞–Ω –∫–ª–∏–µ–Ω—Ç—É"
        DB-->>TxManager: –£—Å–ø–µ—Ö
        TxManager-->>-Service: ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
        
        Service->>Cache: –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        Service-->>-Client: –£—Å–ø–µ—Ö: –∑–∞–∫–∞–∑ –≤—ã–¥–∞–Ω –∫–ª–∏–µ–Ω—Ç—É
    end
```

### –ü—Ä–∏—ë–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

```mermaid
sequenceDiagram
    participant Client as üì± API –ö–ª–∏–µ–Ω—Ç
    participant Service as üîÑ –°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤
    participant TxManager as üîí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    participant Cache as üì¶ –ö—ç—à

    Client->>+Service: –ó–∞–ø—Ä–æ—Å: –ü—Ä–∏–Ω—è—Ç—å –≤–æ–∑–≤—Ä–∞—Ç
    
    Note over Client,Cache: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
    
    Service->>+TxManager: –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤–æ–∑–≤—Ä–∞—Ç–∞
    
    Note over TxManager,DB: –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
    TxManager->>DB: –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑ –ø–æ ID
    DB-->>TxManager: –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
    
    alt –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å –≤–æ–∑–≤—Ä–∞—Ç
        Note right of TxManager: –ü—Ä–æ–≤–µ—Ä–∫–∏:- –ó–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç- –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é- –ë—ã–ª –≤—ã–¥–∞–Ω –∫–ª–∏–µ–Ω—Ç—É- –ù–µ –∏—Å—Ç–µ–∫ —Å—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ (48—á)
        TxManager-->>Service: ‚ùå –í–æ–∑–≤—Ä–∞—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
        Service-->>Client: –û—à–∏–±–∫–∞: –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞
    else –í–æ–∑–≤—Ä–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω
        Note over TxManager,DB: –®–∞–≥ 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞
        
        TxManager->>DB: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ "–í–æ–∑–≤—Ä–∞—â–µ–Ω –∫–ª–∏–µ–Ω—Ç–æ–º"
        Note right of TxManager: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:- –í—Ä–µ–º—è –≤–æ–∑–≤—Ä–∞—Ç–∞- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        DB-->>TxManager: –£—Å–ø–µ—Ö
        TxManager-->>-Service: ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
        
        Service->>Cache: –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        Service-->>-Client: –£—Å–ø–µ—Ö: –≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏–Ω—è—Ç
    end
```

### –í–æ–∑–≤—Ä–∞—Ç –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä—É

```mermaid
sequenceDiagram
    participant Client as üì± API –ö–ª–∏–µ–Ω—Ç
    participant Service as üîÑ –°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤
    participant TxManager as üîí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    participant Cache as üì¶ –ö—ç—à

    Client->>+Service: –ó–∞–ø—Ä–æ—Å: –í–µ—Ä–Ω—É—Ç—å –∑–∞–∫–∞–∑ –∫—É—Ä—å–µ—Ä—É
    Service->>+TxManager: –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    
    Note over TxManager,DB: –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–∫–∞–∑–∞
    TxManager->>DB: –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑ –ø–æ ID
    DB-->>TxManager: –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
    
    alt –ó–∞–∫–∞–∑ –Ω–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å –∫—É—Ä—å–µ—Ä—É
        Note right of TxManager: –ü—Ä–æ–≤–µ—Ä–∫–∏:- –ó–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç- –°—Ç–∞—Ç—É—Å "–í–æ–∑–≤—Ä–∞—â–µ–Ω –∫–ª–∏–µ–Ω—Ç–æ–º"- –ü—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 2 –Ω–µ–¥–µ–ª–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
        TxManager-->>Service: ‚ùå –ù–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å –∫—É—Ä—å–µ—Ä—É
        Service-->>Client: –û—à–∏–±–∫–∞: –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞
    else –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ –∫ –≤–æ–∑–≤—Ä–∞—Ç—É –∫—É—Ä—å–µ—Ä—É
        Note over TxManager,DB: –®–∞–≥ 2: –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        
        TxManager->>DB: –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –ë–î
        DB-->>TxManager: –£—Å–ø–µ—Ö
        TxManager-->>-Service: ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ + ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
        Service->>Cache: –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        Service-->>-Client: –£—Å–ø–µ—Ö: –∑–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–µ–Ω –∫—É—Ä—å–µ—Ä—É
    end
```




